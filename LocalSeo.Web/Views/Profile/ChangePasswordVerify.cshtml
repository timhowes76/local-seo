@model ChangePasswordVerifyViewModel
@{
    ViewData["Title"] = "Verify Password Change";
}

<div class="card" style="max-width:760px;">
    <h2 class="card-title">Verify Password Change</h2>

    @if (!string.IsNullOrWhiteSpace(Model.Message))
    {
        <div class="notice">@Model.Message</div>
    }

    @if (Model.IsInvalidOrExpired)
    {
        <p class="muted">This verification challenge is no longer valid.</p>
        <div class="toolbar">
            <a href="/profile/change-password" class="btn btn-secondary">Start Again</a>
        </div>
    }
    else
    {
        <p class="muted">Enter the code sent to your email address and then choose your new password.</p>
        @if (Model.ExpiresAtUtc.HasValue)
        {
            <p class="muted">Code expires: <strong>@Model.ExpiresAtUtc.Value.ToString("dd MMM yyyy HH:mm 'UTC'")</strong></p>
        }
        @if (Model.LockedUntilUtc.HasValue)
        {
            <p class="muted">Too many attempts. Locked until <strong>@Model.LockedUntilUtc.Value.ToString("dd MMM yyyy HH:mm 'UTC'")</strong>.</p>
        }

        <form method="post" action="/profile/change-password/verify" class="form-grid">
            @Html.AntiForgeryToken()
            <input type="hidden" name="CorrelationId" value="@Model.CorrelationId" />
            <div class="form-row">
                <label for="cp-otp">Verification code</label>
                <input id="cp-otp" name="OtpCode" type="text" inputmode="numeric" pattern="[0-9]{6}" maxlength="6" autocomplete="one-time-code" required />
            </div>
            <div class="form-row">
                <label for="cp-new-password">New password</label>
                @await Html.PartialAsync("_PasswordInput", new PasswordInputModel
                {
                    Id = "cp-new-password",
                    Name = "NewPassword",
                    Autocomplete = "new-password",
                    Required = true
                })
            </div>
            <div class="form-row">
                <label for="cp-confirm-new-password">Confirm new password</label>
                @await Html.PartialAsync("_PasswordInput", new PasswordInputModel
                {
                    Id = "cp-confirm-new-password",
                    Name = "ConfirmNewPassword",
                    Autocomplete = "new-password",
                    Required = true
                })
            </div>
            <div class="form-row">
                <p class="form-help">Password requirements:</p>
                <ul class="form-help password-requirements">
                    <li>At least @Model.PasswordPolicy.MinimumPasswordLength characters</li>
                    @if (Model.PasswordPolicy.RequiresNumber)
                    {
                        <li>At least one number</li>
                    }
                    @if (Model.PasswordPolicy.RequiresCapitalLetter)
                    {
                        <li>At least one capital letter</li>
                    }
                    @if (Model.PasswordPolicy.RequiresSpecialCharacter)
                    {
                        <li>At least one special character</li>
                    }
                </ul>
            </div>
            <div class="toolbar">
                <button type="submit">Change Password</button>
            </div>
        </form>

        <form method="post" action="/profile/change-password/resend" class="toolbar" style="margin-top:8px;">
            @Html.AntiForgeryToken()
            <input type="hidden" name="CorrelationId" value="@Model.CorrelationId" />
            <button type="submit" class="btn btn-secondary">Resend code</button>
        </form>
    }
</div>
