@model GbTownEditModel
@{
    ViewData["Title"] = "Edit Town (GB)";
    var returnQ = (ViewBag.ReturnQ as string ?? string.Empty).Trim();
    var returnStatus = (ViewBag.ReturnStatus as string ?? "active").Trim().ToLowerInvariant();
    var returnCountyId = ViewBag.ReturnCountyId is long countyIdValue && countyIdValue > 0
        ? countyIdValue
        : (long?)null;
    var returnPage = ViewBag.ReturnPage is int p ? Math.Max(1, p) : 1;
    var returnPageSize = ViewBag.ReturnPageSize is int ps ? Math.Clamp(ps, 10, 200) : 50;

    var statusQuery = Uri.EscapeDataString(returnStatus);
    var searchQuery = string.IsNullOrWhiteSpace(returnQ) ? string.Empty : $"&q={Uri.EscapeDataString(returnQ)}";
    var countyQuery = returnCountyId.HasValue ? $"&countyId={returnCountyId.Value}" : string.Empty;
    var backUrl = $"/admin/data-lists/towns-gb?status={statusQuery}{searchQuery}{countyQuery}&page={returnPage}&pageSize={returnPageSize}";
    var actionUrl = $"/admin/data-lists/towns-gb/edit?status={statusQuery}{searchQuery}{countyQuery}&page={returnPage}&pageSize={returnPageSize}";
}

<div class="page-stack">
    <section class="card">
        <div class="toolbar">
            <a href="@backUrl" class="btn btn-secondary">Back to Towns</a>
        </div>
    </section>

    <section class="card">
        <h2 class="card-title">Edit Town</h2>
        <form method="post" action="@actionUrl" class="form-grid">
            @Html.AntiForgeryToken()
            <input type="hidden" name="TownId" value="@Model.TownId" />

            <div class="form-row">
                <label for="TownId">Town ID</label>
                <input id="TownId" type="text" value="@Model.TownId" readonly />
            </div>

            <div class="form-row">
                <label for="CountyId">County</label>
                <select id="CountyId" name="CountyId" class="js-searchable" data-placeholder="Search" required>
                    <option value="">Select County</option>
                    @foreach (var county in Model.CountyOptions)
                    {
                        var countyLabel = county.IsActive ? county.Name : $"{county.Name} (Inactive)";
                        if (Model.CountyId == county.CountyId)
                        {
                            <option value="@county.CountyId" selected>@countyLabel</option>
                        }
                        else
                        {
                            <option value="@county.CountyId">@countyLabel</option>
                        }
                    }
                </select>
                @Html.ValidationMessageFor(x => x.CountyId)
            </div>

            <div class="form-row">
                <label for="Name">Name</label>
                <input id="Name" name="Name" type="text" value="@Model.Name" required />
                @Html.ValidationMessageFor(x => x.Name)
            </div>

            <div class="form-row">
                <label for="Slug">Slug</label>
                <input id="Slug" name="Slug" type="text" value="@Model.Slug" />
            </div>

            <div class="form-row">
                <label for="Latitude">Latitude</label>
                <input id="Latitude" name="Latitude" type="number" step="0.000001" value="@Model.Latitude" />
            </div>

            <div class="form-row">
                <label for="Longitude">Longitude</label>
                <input id="Longitude" name="Longitude" type="number" step="0.000001" value="@Model.Longitude" />
            </div>

            <div class="form-row">
                <label for="ExternalId">External ID</label>
                <input id="ExternalId" name="ExternalId" type="text" value="@Model.ExternalId" />
            </div>

            <div class="form-row">
                <label class="inline-group" for="IsActive">
                    @if (Model.IsActive)
                    {
                        <input id="IsActive" name="IsActive" type="checkbox" value="true" checked />
                    }
                    else
                    {
                        <input id="IsActive" name="IsActive" type="checkbox" value="true" />
                    }
                    <span>Active</span>
                </label>
            </div>

            <div class="toolbar">
                <button type="submit">Save</button>
            </div>
        </form>
    </section>
</div>

